<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Infinite - 我的手记列表</title>
	<meta name="description" content="Admin, Dashboard, Bootstrap, Bootstrap 4, Angular, AngularJS" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	
	<link rel="stylesheet" type="text/css" href="/temp2/assets/styles/app.css" /><!--模板二的样式 -->

	<link rel="import" href="/common/depjs.html" />
    <link rel="import" href="/common/depcss.html" />
	<link rel="import" href="/common/form-js.html" />
</head>
<body>
<div class="row-col">
	<div class="col-sm w w-auto-xs light lt bg-auto">
		<div class="padding pos-rlt">
			<button class="btn btn-outline btn-primary btn-block"
					onclick="addAtc()">写文章</button>
			<div class="hidden-xs-down m-t" id="inbox-menu">
				<div class="nav-active-primary">
					<div class="nav nav-pills nav-sm flex-column">

					</div>
				</div>
				<label class="control-label">Title</label>
				<div class="nav-active-white">
					<ul class="nav nav-pills nav-stacked nav-sm">
						<li class="nav-item">
							<a class="nav-link" onclick="searchByStatus(0)">
								<i class="fa m-r-sm fa-circle text-info"></i> 未发布
							</a>
							<a class="nav-link" onclick="searchByStatus(1)">
								<i class="fa m-r-sm fa-circle text-warn"></i> 已发布
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div class="col-sm">
		<div ui-view class="padding pos-rlt">
			<a href="#" class="md-btn md-fab md-fab-bottom-right pos-fix red" onclick="addAtc()">
				<i class="glyphicon glyphicon-pencil"></i>
			</a>
			<div>
				<!-- header -->
				<div class="m-b">
					<div class="btn-toolbar">
						<input id="searchFilter" type="text" class="form-control" autocomplete="off" placeholder="Say something">
					</div>
				</div>
				<!-- / header -->
				<!-- list -->
				<div class="list white">
					<div id="atcListDiv"></div>
				</div>
				<!-- / list -->
			</div>

		</div>
	</div>
</div>

<!-- 文章展示model -->
<div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
	<div class="modal-dialog modal-full">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
				<div class="modal-title">
					<h4 id="atcTitle" id="modalLabel"></h4>
					<div class="title-icon-box">
						<i class="ion-edit" onclick="edit()"></i>
					</div>
				</div>
			</div>
			<div class="modal-body" id="_modalDialog_body">
				<iframe id="atcView" src="" frameBorder="0" width="99.6%"></iframe>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>
</body>
<script type="text/javascript">
/*全局变量区*/
var min_height = document.documentElement.clientHeight - 200;//获取屏幕高度-头部高度
var AuthorId = 1;
var Status = 1;//1-所有 2-已发布 3-未发布

var AtcList = [];//所有的
var PublishList = [];//已发布的
var UnPublishList = [];//未发布的

var CurAtcId = "";
/*初始化*/
$(function(){
	initAtcList();
	$('#atcView').attr('height',min_height+"px");
});

/*监听区*/
//监听搜索框的回车
$('#searchFilter').bind('keypress',function(e){ 
	if(e.keyCode == 13)      
		searchByTitle();
});
$("#searchFilter").bind("input propertychange",function(){
	searchByTitle();
});
$('body').on('hidden.bs.modal', '.modal', function () {
	$(this).removeData('bs.modal');
});

/*方法区*/
function addAtc(){
	window.parent.getUrl("/infinite/newAtc.html");
}

function edit(){
	window.parent.getUrl("/infinite/newAtc.html?atcId="+CurAtcId);
}

/***数据获取***/
//获取所有文章列表，并初始化全局变量
function initAtcList(){
	var url = Const.Api_URL + "/MyAtcController/getMyAtcList";
	var param = {
		authorId : AuthorId,
		status : 1,
		search : "",
		lable : ""
	};
	View.post(url,param,function(resp){
		AtcList = resp;
		reload_AtcListTmpl(resp);
	},function(){
		
	});
}

//全局变量搜索:标题搜索
function searchByTitle(){
	var titleSearch = $("#searchFilter").val();
	if(titleSearch == ""){
		reload_AtcListTmpl(AtcList);
		return;
	}
	var searchList=[];
	for(var i=0;i<AtcList.length;i++){
		if(AtcList[i].titleInfo.indexOf(titleSearch)!=-1){
			searchList.push(AtcList[i]);
		}
	}
	reload_AtcListTmpl(searchList);
}

//通过id获取文章信息
function getInfoById(id){
	for(var i=0;i<AtcList.length;i++){
		if(AtcList[i].id==id){
			return AtcList[i];
		}
	}
}

function getAtc(id,title){
	CurAtcId = id;
	$("#atcTitle").text(title);
	$("#atcView").attr("src","/infinite/atcView.html?atcId="+id);
}

function searchByStatus(status){
	var searchList=[];
	for(var i=0;i<AtcList.length;i++){
		if(AtcList[i].publishStatus == status){
			searchList.push(AtcList[i]);
		}
	}
	reload_AtcListTmpl(searchList);
}

/***页面渲染***/
//渲染文章列表模板
function reload_AtcListTmpl(list){
	var data = {};
	data.list = list;
	for(var i=0;i<data.list.length;i++){
		data.list[i].createTime = getMyDate(parseInt(data.list[i].createTime));
	}
	var temp = new Tmpl("atcListTmpl",data);
	temp.reset("atcListDiv");
}

function getMyDate(str) {
	var oDate = new Date(str),
			oYear = oDate.getFullYear(),
			oMonth = oDate.getMonth()+1,
			oDay = oDate.getDate(),
			oHour = oDate.getHours(),
			oMin = oDate.getMinutes(),
			oSen = oDate.getSeconds(),
			oTime = oYear +'-'+ addZero(oMonth) +'-'+ addZero(oDay);
	return oTime;
}

function addZero(num){
	if(parseInt(num) < 10){
		num = '0'+num;
	}
	return num;
}

</script>
<script id="atcListTmpl" type="text/html">
{{each list as item}}
<div class="list-item b-l b-l-2x b-info">
	<div class="list-left">
		{{if item.publishStatus===1}}
		<span class="avatar-sm-box bg-orange">P</span>
		{{else if item.publishStatus===0}}
		<span class="avatar-sm-box bg-success">L</span>
		{{/if}}
	</div>
	<div class="list-body">
		<div class="pull-right text-muted text-xs">
			<span class="hidden-xs">{{item.createTime}}</span> <i
				class="fa fa-paperclip m-l-sm"></i>
		</div>
		<div>
			<a href class="_500" data-toggle="modal" data-target="#myModal" onclick="getAtc({{item.id}},'{{item.titleInfo}}')">{{item.titleInfo}}</a>
			<span class="label label-xs m-l-sm text-u-c"></span>
		</div>
		{{if item.description===""}}
		<div class="text-ellipsis text-muted text-sm">主人太懒，没有留下任何说明</div>
		{{else}}
		<div class="text-ellipsis text-muted text-sm">{{item.description}}</div>
		{{/if}}
	</div>
</div>
{{/each}}
</script>
</html>
